---
title: 万锁之母AbstractQueuedSynchronizer
date: 2019-03-12 15:55:02
categories:
tags:
---


































翻看[Java“锁”记](https://pingao777.github.io/2019/03/07/Java%E2%80%9C%E9%94%81%E2%80%9D%E8%AE%B0/)中提到的各种“锁”，其内部同步实现大多数都和一个类`AbstractQueuedSynchronizer`相关，这个类称得上“万锁之母”，所以今天就来扒一扒这个类。

## 整体脉络
为了避免一头扎进去纠缠于各种细节出不来，可以先从宏观上来看一下这个类。首先大家思考一个问题：什么是同步器？假如把线程比作车辆，同步器的角色和警察叔叔差不多，警察的做的事无非是在合适的时机指挥车辆走和停，同步器呢，也是在选择合适的时间调度线程阻塞和执行。

对于车辆来说，什么时候走什么时候停呢，警察叔叔给你招手的时候啊，来来来小伙子，否则就老老实实排队，等警察叔叔给你招手；对于线程来讲也可以采用这种策略，“获得许可”可以执行，否则排队阻塞，等同步器给与你“许可”。如果前方交通比较疏松，警察可能一次会叫好几辆车一起走，如果比较拥堵，则会一辆一辆的来；同步器呢同样如此，它有两种模式：共享和独占，前者允许多个线程一起运行，后者只允许单一线程运行。

## 源码分析
下面进入源码分析，这里只分析共享和独占两种模式下的基本方法：acquire，release和acquireShared，releaseShared
